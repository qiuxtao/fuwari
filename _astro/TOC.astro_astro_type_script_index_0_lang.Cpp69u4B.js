function l(r,e=0){if(!r||r.length===0)return"";let t='<div class="flex flex-col gap-0">';return r.forEach((n,s)=>{const i=`calc(0.75rem + ${e*1}rem)`;let o="",a="transition w-5 h-5 shrink-0 rounded-md text-xs flex items-center justify-center font-bold mt-[0.125rem]";e===0?(a+=" bg-[var(--toc-badge-bg)] text-[var(--btn-content)]",o=`${s+1}`):e===1?o='<div class="transition w-1.5 h-1.5 rounded-[0.1875rem] bg-[var(--toc-badge-bg)]"></div>':o='<div class="transition w-1 h-1 rounded-sm bg-black/5 dark:bg-white/10"></div>';let c="transition text-sm break-words leading-tight mt-[0.125rem]";e===0||e===1?c+=" text-50":c+=" text-30",t+=`
            <div class="flex flex-col relative group-item">
                <a href="#${n.slug}" 
                   class="flex gap-2 items-start relative transition w-full min-h-9 rounded-lg hover:bg-[var(--toc-btn-hover)] active:bg-[var(--toc-btn-active)] py-2 pr-2"
                   style="padding-left: ${i}">
                    <div class="${a}">${o}</div>
                    <div class="${c}">${n.text}</div>
                </a>
                ${l(n.children,e+1)}
            </div>
        `}),t+="</div>",t}function f(r){const e=[],t=[];return r.forEach(n=>{let s=n.text;s.endsWith("#")&&(s=s.substring(0,s.length-1));const i={...n,text:s,children:[]};for(;t.length>0&&t[t.length-1].depth>=i.depth;)t.pop();t.length>0?t[t.length-1].children.push(i):e.push(i),t.push(i)}),e}class g extends HTMLElement{tocEntries=[];headings=[];activeIndicator=null;tocContent=null;ticking=!1;constructor(){super()}refreshTOC=()=>{const e=document.getElementById("toc-data-buffer");this.tocContent=this.querySelector("#toc-content"),this.activeIndicator=this.querySelector("#active-indicator");let t=!1;if(e&&e.dataset.headings)try{const n=JSON.parse(e.dataset.headings);if(n.length>0){t=!0;const s=f(n),i=l(s);this.tocContent&&(this.tocContent.innerHTML=i),this.init()}else this.tocContent&&(this.tocContent.innerHTML="")}catch(n){console.error("Failed to update TOC",n)}else this.tocContent&&(this.tocContent.innerHTML="");this.toggleSidebarLayout(t)};toggleSidebarLayout(e){const t=this.closest(".toc-card"),n=document.getElementById("sidebar-profile"),s=document.getElementById("sidebar-widgets"),i=document.getElementById("sidebar");e?(t&&(t.style.display="block"),n&&(n.style.display="none"),s&&(s.style.display="none")):(t&&(t.style.display="none"),n&&(n.style.display="flex"),s&&(s.style.display="flex"));const o=window.location.pathname.replace(/\/$/,"");o===""||o==="/index.html"||o==="/fuwari"||o==="/fuwari/index.html"?i&&(i.classList.remove("row-start-2"),i.classList.add("row-start-1")):i&&(i.classList.remove("row-start-1"),i.classList.add("row-start-2"))}updateActiveHeading=()=>{const e=window.innerHeight,t=100;let n=-1,s=-1;for(let a=this.headings.length-1;a>=0;a--){const c=this.headings[a];if(!c)continue;if(c.getBoundingClientRect().top<=t){n=a;break}}for(let a=0;a<this.headings.length;a++){const c=this.headings[a];if(!c)continue;c.getBoundingClientRect().top<e&&(s=a)}let i=n,o=s;i===-1&&this.headings.length>0&&(i=0),o<i&&(o=i),this.updateUI(i,o)};updateUI(e,t){if(this.tocEntries.forEach(n=>n.classList.remove("active","text-[var(--primary)]","font-bold")),e!==-1&&t!==-1){for(let i=e;i<=t;i++){const o=this.tocEntries[i];o&&o.classList.add("active","text-[var(--primary)]","font-bold")}const n=this.tocEntries[e],s=this.tocEntries[t];if(this.activeIndicator&&n&&s){this.activeIndicator.classList.remove("hidden");const i=this.activeIndicator.offsetParent;if(i){const o=i.getBoundingClientRect(),a=n.getBoundingClientRect(),c=s.getBoundingClientRect(),d=a.top-o.top,h=c.bottom-a.top;this.activeIndicator.style.top=`${d}px`,this.activeIndicator.style.height=`${h}px`}}}else this.activeIndicator&&this.activeIndicator.classList.add("hidden")}handleAnchorClick=e=>{};onScroll=()=>{this.ticking||(window.requestAnimationFrame(()=>{this.updateActiveHeading(),this.ticking=!1}),this.ticking=!0)};init(){if(this.activeIndicator=this.querySelector("#active-indicator"),this.tocEntries=Array.from(this.querySelectorAll("a[href^='#']")),this.tocEntries.length===0){this.activeIndicator&&this.activeIndicator.classList.add("hidden");return}this.headings=this.tocEntries.map(e=>{const t=decodeURIComponent(e.hash?.substring(1));return document.getElementById(t)}).filter(e=>e instanceof HTMLElement),window.removeEventListener("scroll",this.onScroll),window.addEventListener("scroll",this.onScroll),this.addEventListener("click",this.handleAnchorClick),this.updateActiveHeading()}connectedCallback(){requestAnimationFrame(()=>{this.init();const t=document.getElementById("toc-data-buffer");let n=!1;t&&t.dataset.headings&&(n=JSON.parse(t.dataset.headings).length>0),this.toggleSidebarLayout(n)});const e=()=>{window.swup&&(window.swup.hooks.on("content:replace",()=>{this.refreshTOC()}),window.swup.hooks.on("content:replace",()=>{setTimeout(()=>{this.updateActiveHeading()},100)}))};window.swup?e():document.addEventListener("swup:enable",e)}disconnectedCallback(){window.removeEventListener("scroll",this.onScroll),this.removeEventListener("click",this.handleAnchorClick)}}customElements.get("table-of-contents")||customElements.define("table-of-contents",g);
